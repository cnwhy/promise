/*!
 * easy-promise v0.1.0
 * Homepage https://github.com/cnwhy/promise#readme
 * License BSD-2-Clause
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Promise=e()}(this,function(){"use strict";var t=function(t){function e(t,r){if(n(r))r.then(t.resolve,t.reject);else if(!r||"function"!=typeof r&&"object"!=typeof r)t.resolve(r);else{var o,i=!1;try{o=r.then,"function"==typeof o?o.call(r,function(n){i||(i=!0,e(t,n))},function(e){i||(i=!0,t.reject(e))}):t.resolve(r)}catch(e){i||(i=!0,t.reject(e))}}}function n(t){return t instanceof r}function r(t){function n(t){o.call(c,1,t)}function r(t){o.call(c,0,t)}function i(t){if(!f)return f=!0,c===t?r(new TypeError("The promise and its value refer to the same object")):void e({resolve:n,reject:r},t)}function u(t){f||(f=!0,r(t))}var c=this;this.status=-1,this._events=[];var f=!1;if(this.resolve=i,this.reject=u,t!==s&&"function"==typeof t)try{t(this.resolve,this.reject)}catch(t){this.reject(t)}}function o(t,e){var n=this;~this.status||(this.status=t,t?this.value=e:this.reason=e,i.call(n))}function i(){if(~this.status){for(var t=this,e=t._events,n=t.status?t.value:t.reason,r=t.status?0:1,o=0;o<e.length;o++)!function(e){var o=e[r],i=e[2];u(o,n,i,t.status)}(e[o]);e=[]}}function u(e,n,r,o){var i=r.resolve,u=r.reject;"function"==typeof e?t(function(){var t;try{t=e(n)}catch(t){return void u(t)}i(t)}):o?i(n):u(n)}var s=function(){};return r.defer=function(){var t=new r(s);return{promise:t,resolve:t.resolve,reject:t.reject}},r.resolve=function(t){return n(t)?t:new r(function(e,n){e(t)})},r.reject=function(t){return new r(function(e,n){n(t)})},r.all=function(t){if("[object Array]"!==Object.prototype.toString.call(t))throw new TypeError("The argument is not an array!");return new r(function(e,n){var o=[],i=0,u=t.length,s=function(t){return function(n){o[t]=n,++i==u&&e(o)}};if(u<=0)return e([]);for(var c=0;c<u;c++)r.resolve(t[c]).then(s(c),n)})},r.prototype.toString=function(){return"[object Promise]"},r.prototype.then=function(t,e){var n=this.status,o=r.defer(),i=o.promise;return~n?n&&"function"==typeof t?u(t,this.value,i,n):n||"function"!=typeof e?n?o.resolve(this.value):o.reject(this.reason):u(e,this.reason,i,n):this._events.push([t,e,i]),i},r.prototype.catch=function(t){return this.then(null,t)},r.prototype.finally=function(t){return"function"!=typeof t?this:this.then(function(e){return r.resolve(t()).then(function(){return e})},function(e){return r.resolve(t()).then(function(){throw e})})},r},e=t(function(t){setTimeout(t,0)});return e});